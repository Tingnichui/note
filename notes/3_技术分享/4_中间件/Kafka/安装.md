# Kafka

https://hub.docker.com/r/bitnami/kafka

#### 不设置密码认证 

连接不带密码认证的zookeeper

```shell
docker run -d --name kafka \
    --network tingnichui \
	--network-alias kafka \
    -p 9092:9092 \
    -e KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181 \
    -e KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://192.168.139.101:9092 \
    bitnami/kafka:latest | xargs docker logs -f 
```

#### 设置密码认证

```
addauth digest admin:password
setAcl / auth:admin:cdrwa
```

kafka设置sasl认证

```shell
docker run -d --name kafka \
	-p 9092:9092 \
    --link zookeeper \
    -e KAFKA_ZOOKEEPER_PROTOCOL=SASL \
    -e KAFKA_ZOOKEEPER_USER=admin \
    -e KAFKA_ZOOKEEPER_PASSWORD=password \
    -e KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181 \
    -e ALLOW_PLAINTEXT_LISTENER=yes \
    -e KAFKA_CLIENT_LISTENER_NAME=SASL_PLAINTEXT \
    -e KAFKA_CFG_LISTENERS=PLAINTEXT://:9092，CONTROLLER://:9093 \
    -e KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://:9092 \
    -e KAFKA_CLIENT_USERS=user \
    -e KAFKA_CLIENT_PASSWORDS=password \
    -e KAFKA_CFG_SASL_MECHANISM_INTER_BROKER_PROTOCOL=SASL_PLAINTEXT \
    -e KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,EXTERNAL:PLAINTEXT,PLAINTEXT:PLAINTEXT \
	bitnami/kafka | xargs docker logs -f 
```

```shell
docker run -d --name kafka_sasl \
    -p 9092:9092 \
    --network tingnichui \
    -e KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181 \
    -e KAFKA_CLIENT_LISTENER_NAME=SASL_PLAINTEXT \
    -e KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,SASL_PLAINTEXT://:9093 \
    -e KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092,SASL_PLAINTEXT://localhost:9093 \
    -e KAFKA_CLIENT_USERS=user \
    -e KAFKA_CLIENT_PASSWORDS=password \
    -e KAFKA_CFG_SASL_MECHANISM_INTER_BROKER_PROTOCOL=SASL_PLAINTEXT \
    -e KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=PLAINTEXT:PLAINTEXT,SASL_PLAINTEXT:SASL_PLAINTEXT \
    bitnami/kafka | xargs docker logs -f 
```

```shell
docker run \
    -d --name=kafka \
    -p 9092:9092 \
    --link zookeeper \
    -e KAFKA_ZOOKEEPER_PROTOCOL=SASL \
    -e KAFKA_ZOOKEEPER_USER=admin \
    -e KAFKA_ZOOKEEPER_PASSWORD=password \
    -e KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181 \
    -e KAFKA_CFG_LISTENERS=INTERNAL://:9093,CLIENT://:9092 \
    -e KAFKA_CFG_ADVERTISED_LISTENERS=INTERNAL://127.0.0.1:9093,CLIENT://192.168.139.101:9092 \
    -e KAFKA_CLIENT_USERS=user \
    -e KAFKA_CLIENT_PASSWORDS=password \
    -e KAFKA_CFG_SASL_MECHANISM_INTER_BROKER_PROTOCOL=PLAIN \
    -e KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=INTERNAL:PLAINTEXT,CLIENT:SASL_PLAINTEXT \
    -e KAFKA_CFG_INTER_BROKER_LISTENER_NAME=INTERNAL \
    bitnami/kafka:latest  | xargs docker logs -f 
```

https://zhuanlan.zhihu.com/p/586005021